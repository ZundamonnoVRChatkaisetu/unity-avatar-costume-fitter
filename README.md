# 全アバター衣装自動調整ツール

このツールは、アバターに衣装を自動的に最適化するUnityエディタ拡張です。

## 特徴

- すべてのアバターに対応
- すべての衣装に対応
- ワンクリックで衣装をアバターに合わせる
- ボーンマッピングの手動調整機能
- リアルタイム微調整機能
- ツール情報をUI内に表示

## 使い方

1. Unityのメニューバーから「ずん解」→「衣装調整ツール」を選択
2. アバターと衣装をドラッグ＆ドロップで選択
3. 「ボーンマッピング設定」で必要に応じてボーンの対応関係を調整
4. 「衣装を着せる」ボタンをクリック
5. スライダーを動かして細部を微調整

## インストール方法

1. このリポジトリをダウンロードまたはクローン
2. Unityプロジェクトの「Assets」フォルダに配置
3. これだけで使用可能になります

## ボーンマッピング機能について

アバターと衣装のボーン対応関係を確認・調整できる機能が追加されました。

- アバター側のボーン名と衣装側のボーン名を一覧表示
- ドロップダウンメニューから手動で衣装のボーンを選択可能
- マッピング状態を色分けして表示（OK、手動、未マッピング）
- 「マッピングを更新」ボタンで再分析

マッピングに問題がある場合は、該当するボーンの衣装側のボーンを手動で選択し直すことができます。例えば「Hips」のボーンが「pelvis」という名前になっている衣装の場合に手動で調整できます。

## 要件

- Unity 2019.4以降
- ヒューマノイドアバター

## 最新の改善点

- ボーンマッピングUI追加：アバターと衣装の対応関係を表示・調整可能に
- ボーン位置による自動マッピング機能：名前だけでなく位置も考慮
- 微調整パフォーマンス向上：リアルタイム編集時の処理負荷を大幅軽減
- 部分的な調整精度向上：衣装の各部位を個別に調整可能に
- ボーン対応の精度向上：より多くの命名パターンに対応

## 技術的な仕組み

このツールは以下の方法でアバターに衣装を最適化します：

1. **高度なボーンマッピング**：衣装のボーン構造をアバターのボーン構造に自動的および手動でマッピング
2. **位置ベースのマッピング**：ボーン名だけでなく位置情報も利用して対応関係を判定
3. **インテリジェントスケール調整**：アバターの身長と体型に合わせて衣装のスケールを自動調整
4. **リアルタイム微調整**：上半身、下半身、腕、脚などの部位ごとに即時反映される調整
5. **メッシュの最適化**：頂点とウェイトを最適化し、衣装の変形を最大化

## 問題が発生した場合

衣装がうまく適用されない場合は、以下を確認してください：

1. 「ボーンマッピング設定」を開き、アバターと衣装のボーン対応関係を確認
2. 問題があるボーンは手動で正しいボーンを選択
3. マッピングを更新して再度「衣装を着せる」を実行
4. 「全体スケール」や各部位のスライダーで微調整

それでも問題が解決しない場合は、衣装のボーン構造がアバターと大きく異なっている可能性があります。