# 全アバター衣装自動調整ツール

このツールは、アバターに衣装を自動的に最適化するUnityエディタ拡張です。

## 特徴

- すべてのアバターに対応
- すべての衣装に対応
- 手動ボーンマッピング機能でアバターと衣装の対応関係を調整可能
- ボーン選択機能で対象ボーンをヒエラルキー上で確認
- マッピング対象外のボーンを除外できる機能
- リアルタイム微調整機能
- ツール情報をUI内に表示
- メッシュベース調整機能でボーンマッピングの問題を回避

## 使い方

1. Unityのメニューバーから「ずん解」→「衣装調整ツール」を選択
2. アバターと衣装をドラッグ＆ドロップで選択
3. 「ボーンマッピング」タブでアバターと衣装のボーン対応関係を確認・調整
4. 「衣装を着せる」ボタンをクリック
5. スライダーを動かして細部を微調整

## インストール方法

1. このリポジトリをダウンロードまたはクローン
2. Unityプロジェクトの「Assets」フォルダに配置
3. これだけで使用可能になります

## 要件

- Unity 2019.4以降
- ヒューマノイドアバター

## 最新の改善点 (v1.4.1)

- **部位別メッシュ調整**: 各部位（頭、胴体、腕、脚など）ごとに個別に形状調整を行い、より自然なフィット感を実現
- **参照点システム**: アバターの体型特徴を正確に捉える参照点システムを導入し、部位ごとの特性に基づいた変形を適用
- **メッシュ解析強化**: より精度の高いボディパーツ識別アルゴリズムで衣装の適切な部位を検出
- **非破壊的変形**: 元のメッシュを変更せず、コピーを作成して調整するため安全に操作可能
- **アバターボーン制限**: Armature配下のボーンのみを選択対象に制限（ボーン構造の明確化）
- **マッピング表示改善**: アバターと衣装のボーン対応表示を「⇔」記号で見やすく改善
- **メニュー整理**: ずん解メニューを衣装調整ツールのみに整理

## ボーンマッピングの使い方

1. アバターと衣装を選択すると「ボーンマッピング」タブが利用可能になります
2. アバターのボーンと衣装のボーンの対応関係が表示されます
3. ボーン名をクリックすると、ヒエラルキー上でそのボーンが選択されます
4. 衣装ボーン選択のドロップダウンメニューから以下の選択が可能です：
   - **自動検出**: システムが自動的に適切なマッピングを検出
   - **マッピングなし**: このボーンを衣装のマッピングから除外
   - **特定のボーン**: 手動で対応する衣装のボーンを選択
5. 「除外」ボタンを押すとそのボーンをマッピング対象から除外できます
6. 除外したボーンは「復活」ボタンで再度マッピング対象に戻せます
7. 「マッピングをリセット」ボタンを押すと手動設定を全てクリアします
8. 「除外ボーンをリセット」ボタンを押すと除外設定を全てクリアします

## メッシュで調整機能

ボーンマッピングによる調整がうまくいかない場合は、「メッシュで調整」オプションが有効です。

1. 詳細設定の「メッシュで調整」をチェックします
2. アバターと衣装のメッシュ情報が自動的に解析されます
3. 「衣装を着せる」ボタンをクリックすると、ボーンではなくメッシュ形状に基づいて衣装が調整されます
4. アバターと衣装のメッシュは各部位ごとに解析され、それぞれに適した変形が適用されます
5. この機能は特に以下の場合に効果的です：
   - ボーン構造が大きく異なるアバターと衣装
   - ボーン名の命名規則が異なる場合
   - 複雑な形状の衣装

## 部位ごとの調整について

「メッシュで調整」機能を使用する場合、以下の部位ごとに個別の調整が適用されます：

- **頭部**: 頭の形状に合わせて適切に変形
- **胴体**: アバターの体型に合わせて胴体部分を調整
- **左右の腕**: アバターの腕の長さや太さに合わせて調整
- **左右の脚**: アバターの脚の形状に合わせて調整

各部位は自動的に検出されますが、ボーン名やメッシュ名から判別できない場合は位置情報を使って推定します。

## 問題が発生した場合

衣装がうまく適用されない場合は、以下を確認してください：

1. ボーンマッピングが正しく設定されているか（「ボーンマッピング」タブで確認）
2. 特に重要なボーン（Hips、Spine、Chest、Head など）が正しくマッピングされているか
3. 衣装の特定の部分が固定される場合は、該当部分のボーンに「マッピングなし」を設定してみる
4. 詳細設定で「自動サイズ調整」と「ウェイト最適化」がオンになっているか
5. 「メッシュで調整」オプションを試してみる（ボーンマッピングがうまくいかない場合）
6. 微調整スライダーを使用して手動で調整を試みる

それでも問題が解決しない場合は、「全体スケール」の値を調整してみるか、問題となる特定のボーンの除外/復活を試してみてください。